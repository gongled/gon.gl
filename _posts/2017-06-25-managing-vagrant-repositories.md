---
title: Управление репозиториями Vagrant
updated: 2017-06-25
---

Для запуска виртуальной машины в Vagrant используют [публичные образы](http://www.vagrantbox.es/) или собирают собственный с помощью [Packer](https://www.packer.io/). Компания HashiCorp предлагает использовать сервис Vagrant Cloud для хранения и версионирования этих образов, чтобы распространять обновления в команде разработчиков. Сервис бесплатный, но артефакты публичные и доступны каждому без авторизации.

В корпоративной среде часто требуется размещать ресурсы в закрытой инфраструктуре на подконтрольных серверах. К сожалению, в этом случае нет никакого способа управлять версиями приватных образов. Как следствие, пользователь не узнает об вышедшем обновлении.

Для решения этой проблемы написал [vgrepo](https://github.com/gongled/vgrepo) — простую программу командной строки для управления образами Vagrant. В паре с HTTP-сервером утилита упрощает доставку и обновление образов пользователям. Посмотрите скринкаст с демонстрацией работы:

[![asciicast](https://asciinema.org/a/123313.png)](https://asciinema.org/a/123313)

При запуске команд *up*, *reload* и *resume* Vagrant ищет метаданные образа в формате JSON. По ним Vagrant проверяет локальную версию и доступную в каталоге на сервере. Если у пользователя версия старше, чем в каталоге, то будет предложено обновить образ.

vgrepo призван помочь с управлением образов, сняв головную боль по поддержке метаданных. Данные об образах автоматически изменяются при добавлении и удалении их из каталога.

Пользователю достаточно указать ссылку на JSON в переменной `config.vm.box_url`. Обратите внимание, имя образа в `config.vm.box` должно совпадать с именем в метаданных:

```ruby
Vagrant.configure("2") do |config|
  config.vm.box = "centos7-x64"
  config.vm.box_url = "https://vagrant.gongled.me/r/centos7-x64/"
end
```

На разработку проекта меня вдохновил [туториал по развёртке приватного Vagrant Cloud](https://github.com/hollodotme/Helpers/blob/master/Tutorials/vagrant/self-hosted-vagrant-boxes-with-versioning.md), где подробно описан весь процесс. Если вам нравится проект и вы хотите помочь — присылайте [ишьюсы](https://github.com/gongled/vgrepo/issues/new) и [пул-реквесты](https://github.com/gongled/vgrepo/compare) на Гитхабе. С удовольствием читаю всё, что мне присылают.
